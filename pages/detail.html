<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script src="../js/chartjs/chart.js"></script>
    <script src="../js/danfo0.1.1/index.min.js"></script>
    <link rel="stylesheet" href="../styles/styles.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>

    <script>
        $(document).ready(function(){
            $('.slider').slick({
                'infinite': false
            }).on('swipe', function(event, slick, direction){
                
            });
        });
    </script>
</head>
<body>
    <div id="wrap">
        <div class="slider">
            <div class="comp">
                <h4 class="title">문석 모델이다</h4>
                <div>
                    <canvas id="myChart3"></canvas>
                </div>
                <div class="analysis">
                    <h4>분석결과</h4>
                    <p id="data3_analysis">
                        당신의 결과는 이러쿵 저러쿵 <em>강조강조</em> 이걸 저렇게 하삼
                    </p>
                </div>
            </div>
            <div class="comp">
                <h4 class="title">문석 모델이다</h4>
                <div>
                    <canvas id="myChart4"></canvas>
                </div>
                <div class="analysis">
                    <h4>분석결과</h4>
                    <p id="data4_analysis">
                        당신의 결과는 이러쿵 저러쿵 <em>강조강조</em> 이걸 저렇게 하삼
                    </p>
                </div>
            </div>
            <div class="comp">
                <h4 class="title">문석 모델이다</h4>
                <div>
                    <canvas id="myChart5"></canvas>
                </div>
                <div class="analysis">
                    <h4>분석결과</h4>
                    <p id="data5_analysis">
                        당신의 결과는 이러쿵 저러쿵 <em>강조강조</em> 이걸 저렇게 하삼
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
        let lastData
        if(localStorage.getItem('id')){
            lastData = localStorage.getItem('id')
        }
        
        let ar, armax, armin, artitle
        // labels 
        let dataLabel = ['id', 'title', 'thumbnail', 'view', 'rating', 'commentCount',
       'commentKeyword', 'totalView', 'totalRate', 'totalCommentCount','genPer', 'totalPer']
        const readCsv = (path) => {
            let arcnt = 0
            dfd.read_csv(path)
            .then(df => {
                // 데이터 순서 rating, people, view, id
                ar = df.values
                armax = df.max().data
                armin = df.min().data
                // artitle = df.values
                console.log(df)
    
            }).then(function(){
                // console.log(ar[0])
                // console.log(ar[2])
                // console.log(armax['data'])
                // console.log(armax[0])
    
                arcnt = Array.from({length:ar.length}, (v,i)=>i+1+'회')
                
                let maxindex3, maxindex4, maxindex5, minindex3, minindex4, minindex5
                for(let j=0;j<ar.length;j++){
                    ardata3 = Array.from(ar, x => x.at(3)) // view
                    ardata4 = Array.from(ar, x => x.at(4)) // rating
                    ardata5 = Array.from(ar, x => x.at(5)) // commentcount
                    
                    if (ar.at(j).at(3) === Math.round(armax.at(3) * 100)/100) {
                        maxindex3 = j // max index
                    } 
                    if (ar.at(j).at(4) === Math.round(armax.at(4) * 100)/100){
                        maxindex4 = j // max index
                    }
                    if (ar.at(j).at(5) === Math.round(armax.at(5) * 100)/100){
                        maxindex5 = j // max index
                    }
                    
                    if (ar.at(j).at(3) === Math.round(armin.at(3) * 100)/100) {
                        minindex3 = j // max index
                    } 
                    if (ar.at(j).at(4) === Math.round(armin.at(4) * 100)/100){
                        minindex4 = j // max index
                    }
                    if (ar.at(j).at(5) === Math.round(armin.at(5) * 100)/100){
                        minindex5 = j // max index
                    }
                }

                let circleSize = 10
                let pointRadius3 = Array.from({length:ar.length}, (i)=>3)
                let pointRadius4 = Array.from({length:ar.length}, (i)=>3)
                let pointRadius5 = Array.from({length:ar.length}, (i)=>3)
                pointRadius3 = pointRadius3.fill(circleSize,maxindex3,maxindex3+1)
                pointRadius4 = pointRadius4.fill(circleSize,maxindex4,maxindex4+1)
                pointRadius5 = pointRadius5.fill(circleSize,maxindex5,maxindex5+1)

                pointRadius3 = pointRadius3.fill(circleSize,minindex3,minindex3+1)
                pointRadius4 = pointRadius4.fill(circleSize,minindex4,minindex4+1)
                pointRadius5 = pointRadius5.fill(circleSize,minindex5,minindex5+1)
                
                // styling 
                const bgcolor = ['#00800050', '#ff0000','#fff00']
                let bgcolorOpacity3 = Array.from({length:ar.length}, (i)=>bgcolor.at(0))
                bgcolorOpacity3 = bgcolorOpacity3.fill(bgcolor.at(0),maxindex3,maxindex3+1)
                bgcolorOpacity3 = bgcolorOpacity3.fill(bgcolor.at(0),minindex3,minindex3+1)
    
                let bgcolorOpacity4 = Array.from({length:ar.length}, (i)=>bgcolor.at(1))
                bgcolorOpacity4 = bgcolorOpacity4.fill(bgcolor.at(1)+'50',maxindex4,maxindex4+1)
                bgcolorOpacity4 = bgcolorOpacity4.fill(bgcolor.at(1)+'50',minindex4,minindex4+1)

                let bgcolorOpacity5 = Array.from({length:ar.length}, (i)=>bgcolor.at(1))
                bgcolorOpacity5 = bgcolorOpacity5.fill(bgcolor.at(1)+'50',maxindex5,maxindex5+1)
                bgcolorOpacity5 = bgcolorOpacity5.fill(bgcolor.at(1)+'50',minindex5,minindex5+1)
    
                // console.log(pointRadius)
                const ctx3 = document.getElementById('myChart3');
                const ctx4 = document.getElementById('myChart4');
                const ctx5 = document.getElementById('myChart5');

                const data3 = {
                    labels: arcnt,
                    datasets: [
                        {
                            label: dataLabel[3],
                            data: ardata3,
                            borderColor: bgcolor.at(1),
                            backgroundColor: bgcolorOpacity3,
                            // pointStyle: 'circle',
                            pointRadius: pointRadius3,
                            pointHoverRadius: 15
                        },
                    ]
                }
    
                const data4 = {
                    labels: arcnt,
                    datasets: [
                        {
                            label: dataLabel[4],
                            data: ardata4,
                            borderColor: bgcolor.at(0),
                            backgroundColor: bgcolorOpacity4,
                            // pointStyle: 'circle',
                            pointRadius: pointRadius4,
                            pointHoverRadius: 15
                        },
                    ]
                }
    
                const data5 = {
                    labels: arcnt,
                    datasets: [
                        {
                            label: dataLabel[5],
                            data: ardata5,
                            borderColor: bgcolor.at(2),
                            backgroundColor: bgcolorOpacity5,
                            // pointStyle: 'circle',
                            pointRadius: pointRadius5,
                            pointHoverRadius: 15
                        },
                    ]
                }
    
                new Chart(ctx3, {
                    type: 'line',
                    data: data3,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
    
                new Chart(ctx4, {
                    type: 'line',
                    data: data4,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
    
                new Chart(ctx5, {
                    type: 'line',
                    data: data5,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
            }).then(function(){
                let comment_target = document.getElementById('data3_analysis')
                let comments = ''
                comments += '선택하신 [' + artitle +'] 웹툰의 ' + dataLabel.at(3) + '지표를 분석해보니'
                comments += '동일한 ' + 'genre' + '에서의 평균 대비 약' + '<em class="' + '상승or하락클래스' + '">' + '56' + '%</em> 만큼 낮거나 높았습니다.'
                comment_target.innerHTML = comments
            }).then(function(){
                let comment_target = document.getElementById('data4_analysis')
                let comments = ''
                comments += '선택하신 [' + dataLabel.at(1) +'] 웹툰의 ' + dataLabel.at(4) + '지표를 분석해보니'
                comments += '동일한 ' + 'genre' + '에서의 평균 대비 약' + '<em class="' + '상승or하락클래스' + '">' + '56' + '%</em> 만큼 낮거나 높았습니다.'
                comment_target.innerHTML = comments
            }).then(function(){
                let comment_target = document.getElementById('data5_analysis')
                let comments = ''
                comments += '선택하신 [' + dataLabel.at(1) +'] 웹툰의 ' + dataLabel.at(5) + '지표를 분석해보니'
                comments += '동일한 ' + 'genre' + '에서의 평균 대비 약' + '<em class="' + '상승or하락클래스' + '">' + '56' + '%</em> 만큼 낮거나 높았습니다.'
                comment_target.innerHTML = comments
            }).catch(err => {
                console.log(err);
            })
        }
        // readCsv("../data/total/idl_772265.csv")
        // readCsv("../data/total/idl_398327.csv")
        readCsv("../data/total/"+lastData)
        console.log('현재 실행 중 파일은 '+lastData+'입니다.')
    </script>
</body>
</html>