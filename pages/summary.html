<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="../js/chartjs/chart.js"></script>
    <script src="../js/danfo0.1.1/index.min.js"></script>
    <link rel="stylesheet" href="../styles/styles.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
</head>
<body>
    <div id="wrap">
        <div class="summary_wrap">
            <div class="summary_title">
                <!-- <div id="wtthumb"></div> -->
                <h3 class="title"><em id="wttitle"></em>의 정식연재 확률은?<br /></h3>
                <em id="promote"></em>
                <div class="sub">2020년 12월 기준</div>
            </div>
            <ul class="summary_list">
                <li class="item">
                    <div class="part">조회수</div>
                    <div>
                        <span id="score1"></span>
                        <span id="state1"></span>
                    </div>
                </li>
                <li class="item">
                    <div class="part">평점</div>
                    <div>
                        <span id="score2"></span>
                        <span id="state2"></span>
                    </div>
                </li>
                <li class="item">
                    <div class="part">댓글 수</div>
                    <div>
                        <span id="score3"></span>
                        <span id="state3"></span>
                    </div>
                </li>
            </ul>
            <div class="more">
                <a href="detail.html" class="item_anchor">차트로 비교해 보기</a>
            </div>
        </div>
    </div>
    <script>
        let lastData
        if(localStorage.getItem('id')){
            lastData = localStorage.getItem('id')
        }
        let gbId, gbLabel
        let ar, armax, armin, artitle, arlabel, arcmmtcnt, promote5, promote10
        let arPositive, arView, arRating
        let arPositiveTotal, arViewTotal, arRatingTotal
        let arPosKeyword1, arPosKeyword2, arPosKeyword3
        let arNegKeyword1, arNegKeyword2, arNegKeyword3
        let maxindex3, maxindex4, maxindex5
        let minindex3, minindex4, minindex5
        // labels 
        let dataLabel = ['id', 'title', '5th', '10th', 'first_positive_5', 'second_view_1',
       'third_rating_people_5', 'first_positive_5_mean', 'second_view_1_mean',
       'third_rating_people_5_mean', 'positive', 'view', 'rating_people',
       'positive_mean', 'view_mean', 'rating_people_mean',
       'comment_writer_count', 'comment_writer', 'pos_keyword_1',
       'pos_keyword_2', 'pos_keyword_3', 'neg_keyword_1', 'neg_keyword_2',
       'neg_keyword_3', 'label']

        let userLabel = ['id', 'title', '5회차승격확률', '10회차확률', 'first_positive_5', 'second_view_1',
       'third_rating_people_5', 'first_positive_5_mean', 'second_view_1_mean',
       'third_rating_people_5_mean', '긍정댓글수', '조회수', '평점참여자',
       '긍정댓글수 전체평균', '조회수 전체평균', '평점참여자 전체평균',
       'comment_writer_count', '독자', '긍정키워드1',
       '긍정키워드2', '긍정키워드3', '부정키워드1', '부정키워드2',
       '부정키워드3', '승격여부']

        const readCsv = (path) => {
            let arcnt = 0
            dfd.read_csv(path)
            .then(df => {
                ar = df.values
                armax = df.max().data
                armin = df.min().data
                arcnt = Array.from({length:ar.length}, (v,i)=>i+1+'회')
                // aridIndex   = arids.indexOf(lastData)
                // aridIndex   = arids.indexOf(15067)
                // eval('gbId_'+ar.at(aridIndex).at(0)+' = df.groupby(["id"]).get_groups(['+ar.at(aridIndex).at(0)+']).values')
                
                arids            = Array.from(ar, x => x.at(0))
                artitle          = Array.from(ar, x => x.at(1))
                promote5         = Math.round(ar.at(0).at(2))
                promote10        = Math.round(ar.at(0).at(3))
                promote5         = Math.ceil(ar.at(0).at(2)*100)
                promote10        = Math.ceil(ar.at(0).at(3)*100)
                arPositive       = Array.from(ar, x => x.at(10))
                arView           = Array.from(ar, x => x.at(11))
                arRating         = Array.from(ar, x => x.at(12))
                arPositiveTotal  = Array.from(ar, x => x.at(13))
                arViewTotal      = Array.from(ar, x => x.at(14))
                arRatingTotal    = Array.from(ar, x => x.at(15))
                for(let j=0;j<ar.length;j++){
                    if (ar.at(j).at(10) === Math.round(armax.at(10) * 100)/100) {
                        maxindex3 = j // max index
                    } 
                    if (ar.at(j).at(11) === Math.round(armax.at(11) * 100)/100){
                        maxindex4 = j // max index
                    }
                    if (ar.at(j).at(12) === Math.round(armax.at(12) * 100)/100){
                        maxindex5 = j // max index
                    }
                    
                    if (ar.at(j).at(10) === Math.round(armin.at(10) * 100)/100) {
                        minindex3 = j // max index
                    } 
                    if (ar.at(j).at(11) === Math.round(armin.at(11) * 100)/100){
                        minindex4 = j // max index
                    }
                    if (ar.at(j).at(12) === Math.round(armin.at(12) * 100)/100){
                        minindex5 = j // max index
                    }
                }
                
            }).then(function(){
                let comment_target1 = document.getElementById('promote')
                let comment_target2 = document.getElementById('wttitle')
                let comments1 = promote5 + '%'
                let comments2 = artitle.at(0)
                comment_target1.innerHTML = comments1
                comment_target2.innerHTML = comments2
            }).then(function(){
                let comment_target1 = document.getElementById('score1')
                let comment_target2 = document.getElementById('state1')
                let comments1 = ''
                let comments2 = ''
                comments1 += 'NN' + '%'
                comments2 += '높다'
                comment_target1.innerHTML = comments1
                comment_target2.innerHTML = comments2
            }).then(function(){
                let comment_target1 = document.getElementById('score2')
                let comment_target2 = document.getElementById('state2')
                let comments1 = ''
                let comments2 = ''
                comments1 += '52' + '%'
                comments2 += '낮다'
                comment_target1.innerHTML = comments1
                comment_target2.innerHTML = comments2
            }).then(function(){
                let comment_target1 = document.getElementById('score3')
                let comment_target2 = document.getElementById('state3')
                let comments1 = ''
                let comments2 = ''
                comments1 += '24' + '%'
                comments2 += '낮다'
                comment_target1.innerHTML = comments1
                comment_target2.innerHTML = comments2
            }).catch(err => {
                console.log(err);
            })
        }
        // readCsv("data/total/idl_772265.csv")
        // readCsv("./data/total/idl_398327.csv")
        // readCsv("../data/total/id_123456.csv")
        // readCsv("../data/total/id_15067.csv")
        readCsv("../data/total/id_"+lastData+'.csv')
        localStorage.setItem('id',lastData)
        console.log('현재 실행 중 파일은 '+'id_'+lastData+'csv'+'입니다.')
    </script>
</body>
</html>