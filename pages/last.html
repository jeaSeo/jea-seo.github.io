<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>작전명: 띵작을 찾아서</title>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="../js/chartjs/chart.js"></script>
    <script src="../js/danfo0.1.1/index.min.js"></script>
    <link rel="stylesheet" href="../styles/styles.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script>
        $(document).ready(function(){
            $('.slider').slick({
                'infinite': false
            }).on('swipe', function(event, slick, direction){
                
            });
        });
    </script>
</head>
<body>
    <div id="wrap">
        <div class="last_wrap">
            <p>
            작가님의 작품에 가장 많은 댓글을 남긴 독자의 id는 <em id="bigfan"></em> 입니다.
            뿐만 아니라 (댓글작성자수) 명의 독자들이 작가님을 기다리고 있어요!

            명언 출력(아래 명언 모음 중에 하나 랜덤 출력.. 랜덤 출력이 좀 어려우시면 그냥 이중에 제일 좋은거 골라서 맨날 이거 하나 보여주는걸로 어떤가용?)

            웹툰 플랫폼에서 작가님의 작품을 뵙는 그 날까지 응원하겠습니다. 
            - 웹툰 발굴단 일동 -

            명언 모음
            "누구나 자기만의 거울을 들고 살아야 해요. 사람이 자신의 얼굴을 스스로 바라보면서 거짓말을 하진 못하거든요. 늘 자신을 비춰보고 다잡는 마음으로 살아가는 것이 중요해요" - 윤태호 작가님 <미생>, <이끼>, <내부자들>, <인천상륙작전> 등

            "자기 욕망이 너무 폭발적이고 커서 세상이 어떻든지 창작을 해야 살 수 있어요. 세상이 좋아지건 나빠지건 작가인 거죠. 그걸 견딜 수 있는 사람, 그 태도까지를 재능으로 봐요. 창작자들의 복지나 이런 건 별개에요. 이해타산적인 지점이 아니라 욕망의 크기를 봐야죠. 욕망이 분명한 사람만 구체화하기 위해 나아갈 수 있어요. 그걸 기꺼이 감수할 사람인가까지가 재능이에요." - 윤태호 작가님 <미생>, <이끼>, <내부자들>, <인천상륙작전> 등

            "어떤 일을 맹렬하게 연습하다 보면 내 길이 아니란 걸 빨리 알 수 있어요. 그 때 후회없이 다른 길을 가면 되는거에요. 열심히 해봤으니 미련이 없죠. 근데 주변주에서 어슬렁거리는 사람은 미련이 남아 갔다가 돌아오고, 갔다가 돌아와요. 계속 주변인만 되는 거죠. 그게 진짜 인생낭비에요. 일을 하겠다고 마음을 먹었다면 뜨겁게 하세요." - 윤태호 작가님 <미생>, <이끼>, <내부자들>, <인천상륙작전> 등

            "기초 없이 이룬 성취는 단계를 오르는 것이 아니라 성취 후 다시 바닥으로 돌아오게 된다." - 윤태호 작가님 <미생>, <이끼>, <내부자들>, <인천상륙작전> 등
            "우리가 할 수 있는 노력은 과정이 전부야! 결과는 우리 손 안에 있지 않아!" - 윤태호 작가님 <미생>, <이끼>, <내부자들>, <인천상륙작전> 등
            "흔들리는 건 당신의 눈이다. 활시위를 당기는 손이다. 명중할 수 있을까 의심하는 마음이다. 과녁은 늘 그 자리에 있다."
            "어떤 것이 당신이 계획대로 되지 않는 다고 해서 그것이 불필요한 것은 아니다." - 토마스 A. 에디슨
            "개선이란 무언가가 좋지 않다고 느낄 수 있는 사람들에 의해서만 만들어질 수 있다." - 프레드리히 니체
            "우리가 할 수 있는 최선을 다할 때, 우리 혹은 타인의 삶에 어떤 기적이 나타나는지 아무도 모른다." - 헬렌 켈러
            "미래를 결정짓고 싶다면 과거를 공부하라." - 공자
            "춤추는 별을 잉태하려면 반드시 스스로의 내면에 혼돈을 지녀야 한다." - 프레드리히 니체
        </p>
        </div>
    </div>
    <script>
        let lastData, readfile
        if(localStorage.getItem('id')){
            // result1 591250
            // result2 714582
            // result3 803047
            lastData = localStorage.getItem('id')
            readfile = (Number(lastData)>591250) ? 'result2.csv' : 
            (Number(lastData)>714582) ? 'result3.csv' : 'result1.csv'
        }
        let gbId, gbLabel
        let ar, armax, armin, aridIndex, artitle, arlabel, arcmmtcnt, promote5, promote10, bigfan
        let arPositive, arView, arRating
        let first_positive_5, second_view_1, third_rating_people_5
        let first_positive_5_1, second_view_1_1, third_rating_people_5_1
        let first_positive_5_genre, second_view_1_genre, third_rating_people_5_genre
        let arPositiveTotal, arViewTotal, arRatingTotal
        let arPosKeyword1, arPosKeyword2, arPosKeyword3
        let arNegKeyword1, arNegKeyword2, arNegKeyword3
        let maxindex3, maxindex4, maxindex5
        let minindex3, minindex4, minindex5
        // labels 
        const dataLabel = ['id', 'title', '5th', '10th', 
        'first_positive_5', 'second_view_1','third_rating_people_5', 
        'first_positive_5_1', 'second_view_1_1',
        'third_rating_people_5_1', 'first_positive_5_episode',
        'second_view_1_episode', 'third_rating_people_5_episode', 'positive',
        'view', 'rating_people', 'positive_1', 'view_1', 'rating_people_1',
        'positive_episode', 'view_episode', 'rating_people_episode',
        'comment_writer_count', 'comment_writer', 'pos_keyword_1',
        'pos_keyword_2', 'pos_keyword_3', 'neg_keyword_1', 'neg_keyword_2',
        'neg_keyword_3', 'label', 'first_positive_5_story',
        'second_view_1_story', 'third_rating_people_5_story', 'positive_story',
        'view_story', 'rating_people_story', 'first_positive_5_omnibus',
        'second_view_1_omnibus', 'third_rating_people_5_omnibus',
        'positive_omnibus', 'view_omnibus', 'rating_people_omnibus']

        const userLabel = ['id', '제목', '5회차 기준 승격확률', '10회차 기준 승격확률', 
        '5회차 긍정댓글수', '1회차 조회수', '5회차 평점참여인원', 
        '정식승격 작품의 5회차 긍정댓글수 평균', '정식승격 작품의 1회차 조회수 평균','정식승격 작품의 5회차 평점참여인원 평균', 
        '동일 전개방식 작품의 5회차의 긍정댓글수','동일 전개방식 작품의 1회차의 조회수', '동일 전개방식 작품의 5회차의 평점참여인원', 
        '긍정댓글수', '조회수', '평점참여인원', 
        '정식승격 작품의 긍정댓글수 평균', '정식승격 작품의 조회수 평균', '정식승격 작품의 5회차 평점참여인원 평균',
        '동일 전개방식 작품의 긍정댓글수 평균', '동일 전개방식 작품의 조회수 평균', '동일 전개방식 작품의 평점참여인원 평균',
        '댓글수', '댓글 작성자', 
        '긍정 키워드1', '긍정 키워드2', '긍정 키워드3', 
        '부정 키워드1', '부정 키워드2', '부정 키워드3', 
        '승격여부', 
        'first_positive_5_story', 'second_view_1_story', 'third_rating_people_5_story', 
        'positive_story', 'view_story', 'rating_people_story', 
        'first_positive_5_omnibus', 'second_view_1_omnibus', 
        'third_rating_people_5_omnibus', 'positive_omnibus', 
        'view_omnibus', 'rating_people_omnibus']

        let userlabelforchart = [[],[],[],[],
            ['5회차 긍정댓글수'], ['1회차 조회수'], ['5회차 평점참여인원'], 
            ['정식승격 작품의','5회차 긍정댓글수 평균'], ['정식승격 작품','1회차 조회수 평균'],['정식승격 작품의','5회차 평점참여인원 평균'], 
            ['동일 전개방식 작품의','5회차의 긍정댓글수'],['동일 전개방식 작품의','1회차의 조회수'], ['동일 전개방식 작품의','5회차의 평점참여인원'], 
            ['긍정댓글 수'], ['조회수'], ['평점참여인원'], 
            ['정식승격 작품의','긍정댓글수 평균'], ['정식승격 작품의','조회수 평균'], ['정식승격 작품의','5회차 평점참여인원 평균'],
            ['동일 전개방식 작품의','긍정댓글수 평균'], ['동일 전개방식 작품의','조회수 평균'], ['동일 전개방식 작품의','평점참여인원 평균']
        ]

        const readCsv = (path) => {
            let arcnt = 0
            dfd.read_csv(path)
            .then(df => {
                ar = df.values
                armax = df.max().data
                armin = df.min().data
                eval('lastdataDf'+' =df.groupby(["id"]).get_groups(['+lastData+']).values')
                arcnt = Array.from({length:lastdataDf.length}, (v,i)=>i+1+'회')
                
                arids                         = Array.from(lastdataDf, x => x.at(0))
                artitle                       = Array.from(lastdataDf, x => x.at(1))
                promote5                      = Math.round(lastdataDf.at(0).at(2))
                promote10                     = Math.round(lastdataDf.at(0).at(3))
                promote5                      = Math.ceil(lastdataDf.at(0).at(2)*100)
                promote10                     = Math.ceil(lastdataDf.at(0).at(3)*100)
                
                first_positive_5              = Array.from(lastdataDf, x => x.at(4))
                second_view_1                 = Array.from(lastdataDf, x => x.at(5))
                third_rating_people_5         = Array.from(lastdataDf, x => x.at(6))

                first_positive_5_1            = Math.ceil(lastdataDf.at(0).at(7))
                second_view_1_1               = Math.ceil(lastdataDf.at(0).at(8))
                third_rating_people_5_1       = Math.ceil(lastdataDf.at(0).at(9))

                arPositive                    = Array.from(lastdataDf, x => Math.ceil(x.at(13)))
                arView                        = Array.from(lastdataDf, x => Math.ceil(x.at(14)))
                arRating                      = Array.from(lastdataDf, x => Math.ceil(x.at(15)))

                arPositiveTotal               = Array.from(lastdataDf, x => Math.ceil(x.at(16)))
                arViewTotal                   = Array.from(lastdataDf, x => Math.ceil(x.at(17)))
                arRatingTotal                 = Array.from(lastdataDf, x => Math.ceil(x.at(18)))
                
                bigfan                        = lastdataDf.at(0).at(18)

                if (ar.at(0).at(10) != NaN) {
                    first_positive_5_genre        = Math.ceil(lastdataDf.at(0).at(10))
                    second_view_1_genre           = Math.ceil(lastdataDf.at(0).at(11))
                    third_rating_people_5_genre   = Math.ceil(lastdataDf.at(0).at(12))
                    positive_genre                = Math.ceil(lastdataDf.at(0).at(19))
                    view_genre                    = Math.ceil(lastdataDf.at(0).at(20))
                    rating_people_genre           = Math.ceil(lastdataDf.at(0).at(21))
                } else if (ar.at(0).at(31) != NaN) {
                    first_positive_5_genre        = Math.ceil(lastdataDf.at(0).at(31))
                    second_view_1_genre           = Math.ceil(lastdataDf.at(0).at(32))
                    third_rating_people_5_genre   = Math.ceil(lastdataDf.at(0).at(33))
                    positive_genre                = Math.ceil(lastdataDf.at(0).at(34))
                    view_genre                    = Math.ceil(lastdataDf.at(0).at(35))
                    rating_people_genre           = Math.ceil(lastdataDf.at(0).at(36))
                } else if (ar.at(0).at(37) != NaN) {
                    first_positive_5_genre        = Math.ceil(lastdataDf.at(0).at(37))
                    second_view_1_genre           = Math.ceil(lastdataDf.at(0).at(38))
                    third_rating_people_5_genre   = Math.ceil(lastdataDf.at(0).at(39))
                    positive_genre                = Math.ceil(lastdataDf.at(0).at(40))
                    view_genre                    = Math.ceil(lastdataDf.at(0).at(41))
                    rating_people_genre           = Math.ceil(lastdataDf.at(0).at(42))
                }

                console.log(arPositive)
                // console.log(first_positive_5_1)
                // console.log(first_positive_5_genre)

                for(let j=0;j<lastdataDf.length;j++){
                    if (ar.at(j).at(13) === Math.round(armax.at(13) * 100)/100) {
                        maxindex3 = j // max index
                    } 
                    if (ar.at(j).at(14) === Math.round(armax.at(14) * 100)/100){
                        maxindex4 = j // max index
                    }
                    if (ar.at(j).at(15) === Math.round(armax.at(15) * 100)/100){
                        maxindex5 = j // max index
                    }
                    
                    if (ar.at(j).at(13) === Math.round(armin.at(13) * 100)/100) {
                        minindex3 = j // max index
                    } 
                    if (ar.at(j).at(14) === Math.round(armin.at(14) * 100)/100){
                        minindex4 = j // max index
                    }
                    if (ar.at(j).at(15) === Math.round(armin.at(15) * 100)/100){
                        minindex5 = j // max index
                    }
                }
                
            }).then(function(){
                let comment_target1 = document.getElementById('promote')
                let comment_target2 = document.getElementById('wttitle')
                let comments1 = promote5 + '%'
                let comments2 = artitle.at(0)
                comment_target1.innerHTML = comments1
                comment_target2.innerHTML = comments2
            }).then(function(){
                let comment_target1 = document.getElementById('score1')
                let comment_target2 = document.getElementById('state1')
                let comment_target3 = document.getElementById('part1')
                let comments1 = ''
                let comments2 = ''
                let comments3 = userLabel.at(13)
                if ((((Math.round(armax.at(16)) - Math.round(armax.at(13))) * 100)/100)<0) {
                    comments1 += '다른 작품보다 '+ (((Math.round(armax.at(13)) - Math.round(armax.at(16))) * 100)/100)
                    comments2 += '개 <em class="high">많아요!</em>'
                } else {
                    comments1 += (((Math.round(armax.at(16)) - Math.round(armax.at(13))) * 100)/100)
                    comments2 += '개 <em class="low">적어요.</em>'
                }
                comment_target1.innerHTML = comments1
                comment_target2.innerHTML = comments2
                comment_target3.innerHTML = comments3
            }).then(function(){
                let comment_target1 = document.getElementById('score2')
                let comment_target2 = document.getElementById('state2')
                let comment_target3 = document.getElementById('part2')
                let comments1 = ''
                let comments2 = ''
                let comments3 = userLabel.at(14)
                if ((((Math.round(armax.at(17)) - Math.round(armax.at(14))) * 100)/100)<0) {
                    comments1 += '다른 작품보다 '+ (((Math.round(armax.at(14)) - Math.round(armax.at(17))) * 100)/100)
                    comments2 += '회 <em class="high">많아요!</em>'
                } else {
                    comments1 += (((Math.round(armax.at(17)) - Math.round(armax.at(14))) * 100)/100)
                    comments2 += '회 <em class="low">적어요.</em>'
                }
                comment_target1.innerHTML = comments1
                comment_target2.innerHTML = comments2
                comment_target3.innerHTML = comments3
            }).then(function(){
                let comment_target1 = document.getElementById('score3')
                let comment_target2 = document.getElementById('state3')
                let comment_target3 = document.getElementById('part3')
                let comments1 = ''
                let comments2 = ''
                let comments3 = userLabel.at(15)
                if ((((Math.round(armax.at(18)) - Math.round(armax.at(15))) * 100)/100)<0) {
                    comments1 += '다른 작품보다 '+ (((Math.round(armax.at(15)) - Math.round(armax.at(18))) * 100)/100)
                    comments2 += '명 <em class="high">많아요!</em>'
                } else {
                    comments1 += (((Math.round(armax.at(18)) - Math.round(armax.at(15))) * 100)/100)
                    comments2 += '명 <em class="low">적어요.</em>'
                }
                comment_target1.innerHTML = comments1
                comment_target2.innerHTML = comments2
                comment_target3.innerHTML = comments3
            
            }).then(function() {
                let bigfanTarget = document.getElementById('bigfan')
                let fan = bigfan
                bigfanTarget.innerHTML = fan
            }).then(function() {
                
                let circleSize = 10
                let pointRadius3 = Array.from({length:ar.length}, (i)=>3)
                let pointRadius4 = Array.from({length:ar.length}, (i)=>3)
                let pointRadius5 = Array.from({length:ar.length}, (i)=>3)
                pointRadius3 = pointRadius3.fill(circleSize,maxindex3,maxindex3+1)
                pointRadius4 = pointRadius4.fill(circleSize,maxindex4,maxindex4+1)
                pointRadius5 = pointRadius5.fill(circleSize,maxindex5,maxindex5+1)

                pointRadius3 = pointRadius3.fill(circleSize,minindex3,minindex3+1)
                pointRadius4 = pointRadius4.fill(circleSize,minindex4,minindex4+1)
                pointRadius5 = pointRadius5.fill(circleSize,minindex5,minindex5+1)
                
                // styling 
                const bgcolor = ['#00800050', '#ff0000','#fff000']
                let bgcolorOpacity3 = Array.from({length:ar.length}, (i)=>bgcolor.at(1))
                bgcolorOpacity3 = bgcolorOpacity3.fill(bgcolor.at(1)+'50',maxindex3,maxindex3+1)
                bgcolorOpacity3 = bgcolorOpacity3.fill(bgcolor.at(1)+'50',minindex3,minindex3+1)
    
                let bgcolorOpacity4 = Array.from({length:ar.length}, (i)=>bgcolor.at(0))
                bgcolorOpacity4 = bgcolorOpacity4.fill(bgcolor.at(0),maxindex4,maxindex4+1)
                bgcolorOpacity4 = bgcolorOpacity4.fill(bgcolor.at(0),minindex4,minindex4+1)

                let bgcolorOpacity5 = Array.from({length:ar.length}, (i)=>bgcolor.at(2))
                bgcolorOpacity5 = bgcolorOpacity5.fill(bgcolor.at(2)+'50',maxindex5,maxindex5+1)
                bgcolorOpacity5 = bgcolorOpacity5.fill(bgcolor.at(2)+'50',minindex5,minindex5+1)

                // console.log(pointRadius3)
                const ctx1 = document.getElementById('myChart1');
                const ctx2 = document.getElementById('myChart2');
                const ctx3 = document.getElementById('myChart3');

                const data1 = {
                    labels: [userlabelforchart[4],userlabelforchart[7],userlabelforchart[10]],
                    datasets: [
                        {
                            data: [first_positive_5, first_positive_5_1, first_positive_5_genre],
                            borderColor: bgcolor.at(1),
                            backgroundColor: bgcolorOpacity3,
                            pointRadius: pointRadius3,
                            pointHoverRadius: 15
                        }
                    ]
                }
                console.log(first_positive_5_1)

                const data2 = {
                    labels: [userlabelforchart[5],userlabelforchart[8],userlabelforchart[11]],
                    datasets: [
                        {
                            data: [second_view_1, second_view_1_1, second_view_1_genre],
                            borderColor: bgcolor.at(0),
                            backgroundColor: bgcolorOpacity4,
                            pointRadius: pointRadius4,
                            pointHoverRadius: 15
                        },
                    ]
                }

                const data3 = {
                    labels: [userlabelforchart[6],userlabelforchart[9],userlabelforchart[12]],
                    datasets: [
                        {
                            data: [third_rating_people_5, third_rating_people_5_1, third_rating_people_5_genre],
                            borderColor: bgcolor.at(0),
                            backgroundColor: bgcolorOpacity4,
                            pointRadius: pointRadius4,
                            pointHoverRadius: 15
                        },
                    ]
                }

                new Chart(ctx1, {
                    type: 'bar',
                    data: data1,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });

                new Chart(ctx2, {
                    type: 'bar',
                    data: data2,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });

                new Chart(ctx3, {
                    type: 'bar',
                    data: data3,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });

            }).catch(err => {
                console.log(err);
            })
        }
        readCsv("../data/total/" + readfile)
        localStorage.setItem('id',lastData)
        console.log('현재 실행 중 파일은 '+readfile+'이고 아이디는 '+lastData+'입니다.')
    </script>
</body>
</html>